-- tr_account Table Create SQL
CREATE TABLE tr_account
(
    `no`            TINYINT        NOT NULL    AUTO_INCREMENT COMMENT 'AI Index',
    `id`            VARCHAR(20)    NOT NULL    COMMENT '아이디',
    `password`      CHAR(60)       NOT NULL    COMMENT '패스워드',
    `name`          VARCHAR(10)    NOT NULL    COMMENT '이름',
    `email`         VARCHAR(45)    NOT NULL    COMMENT '이메일',
    `email_status`  CHAR(8)        NOT NULL    DEFAULT 'INACTIVE' COMMENT '이메일 인증',
    `status`        CHAR(5)        NOT NULL    DEFAULT 'ALIVE' COMMENT '회원 상태',
    `registered`    TIMESTAMP      NOT NULL    DEFAULT current_timestamp COMMENT '가입 일자',
    `updated`       TIMESTAMP      NOT NULL    DEFAULT current_timestamp COMMENT '업데이트 날자',
     PRIMARY KEY (no)
);

ALTER TABLE tr_account COMMENT '회원 테이블';

CREATE UNIQUE INDEX UQ_tr_account_1
    ON tr_account(id, email);


-- tr_payment_log Table Create SQL
CREATE TABLE tr_payment_log
(
    `no`                   INT          NOT NULL    AUTO_INCREMENT COMMENT 'AI Index',
    `user_no`              TINYINT      NOT NULL    COMMENT '결재 유저PK',
    `total_amount`         INT          NOT NULL    COMMENT '결재 금액',
    `method`               CHAR(10)     NOT NULL    COMMENT '결재 방식',
    `payment_information`  JSON         NOT NULL    DEFAULT '{}' COMMENT '결제 정보',
    `status`               CHAR(10)     NOT NULL    COMMENT '결재 상태',
    `cancels`              JSON         NOT NULL    DEFAULT '{}' COMMENT '취소 정보',
    `requested_at`         TIMESTAMP    NOT NULL    DEFAULT current_timestamp COMMENT '결제일자',
    `approved_at`          TIMESTAMP    NULL        COMMENT '승인일자',
     PRIMARY KEY (no)
);

ALTER TABLE tr_payment_log COMMENT '결재 로그 테이블';

ALTER TABLE tr_payment_log
    ADD CONSTRAINT FK_tr_payment_log_user_no_tr_account_no FOREIGN KEY (user_no)
        REFERENCES tr_account (no) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- tr_account_admin Table Create SQL
CREATE TABLE tr_account_admin
(
    `no`          TINYINT        NOT NULL    AUTO_INCREMENT COMMENT 'AI Index',
    `id`          VARCHAR(20)    NOT NULL    COMMENT '아이디',
    `password`    CHAR(60)       NOT NULL    COMMENT '패스워드',
    `name`        VARCHAR(10)    NOT NULL    COMMENT '관리자명',
    `authority`   TINYINT        NOT NULL    DEFAULT 0 COMMENT '권한(0:최고)',
    `status`      CHAR(5)        NOT NULL    DEFAULT 'ALIVE' COMMENT '계정 상태',
    `registered`  TIMESTAMP      NOT NULL    DEFAULT current_timestamp COMMENT '등록 일자',
    `updated`     TIMESTAMP      NOT NULL    DEFAULT current_timestamp COMMENT '업데이트 일자',
     PRIMARY KEY (no)
);

ALTER TABLE tr_account_admin COMMENT '관리자 테이블';

CREATE UNIQUE INDEX UQ_tr_account_admin_1
    ON tr_account_admin(id, name);


-- tr_mileage Table Create SQL
CREATE TABLE tr_mileage
(
    `no`                 TINYINT        NOT NULL    AUTO_INCREMENT COMMENT 'AI Index',
    `user_no`            TINYINT        NOT NULL    COMMENT '유저 PK',
    `payment_no`         INT            NULL        COMMENT '결재 로그 PK',
    `status`             VARCHAR(10)    NOT NULL    COMMENT '행동',
    `before_mileage`     INT            NOT NULL    DEFAULT 0 COMMENT '이전 소유 마일리지',
    `use_mileage`        INT            NOT NULL    DEFAULT 0 COMMENT '변동 마일리지',
    `total_mileage`      INT            NOT NULL    DEFAULT 0 COMMENT '총 소유 마일리지',
    `registration_date`  TIMESTAMP      NOT NULL    DEFAULT current_timestamp COMMENT '등록일자',
     PRIMARY KEY (no)
);

ALTER TABLE tr_mileage COMMENT '마일리지 테이블';

ALTER TABLE tr_mileage
    ADD CONSTRAINT FK_tr_mileage_payment_no_tr_payment_log_no FOREIGN KEY (payment_no)
        REFERENCES tr_payment_log (no) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE tr_mileage
    ADD CONSTRAINT FK_tr_mileage_user_no_tr_account_no FOREIGN KEY (user_no)
        REFERENCES tr_account (no) ON DELETE RESTRICT ON UPDATE RESTRICT;


